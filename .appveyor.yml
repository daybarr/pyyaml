# TODO: update this from inside the build to use branch current version
version: '{build}'

#cache:
#- 'C:\Python38\'
#- 'C:\Python38-x64'
build: Script

environment:
  libyaml_repo_url: https://github.com/yaml/libyaml.git
  libyaml_refspec: 0.2.2
  PYYAML_TEST_GROUP: all


  matrix:
    - PYTHON_VER: Python27
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    - PYTHON_VER: Python27-x64
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    - PYTHON_VER: Python36
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    - PYTHON_VER: Python36-x64
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    - PYTHON_VER: Python37
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    - PYTHON_VER: Python37-x64
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    - PYTHON_VER: Python38
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    - PYTHON_VER: Python38-x64
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    - PYTHON_VER: Python39
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
    - PYTHON_VER: Python39-x64
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
    - TOXENV: py27
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
    - TOXENV: py36
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
    - TOXENV: py37
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
    - TOXENV: py38
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
    - TOXENV: py39
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
    - TOXENV: py27
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
      platform: arm64
    - TOXENV: py36
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
      platform: arm64
    - TOXENV: py37
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
      platform: arm64
    - TOXENV: py38
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
      platform: arm64
    - TOXENV: py39
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
      platform: arm64

for:
-
  matrix:
    only:
      - image: Ubuntu
  build_script:
    - echo "Ubuntu build script $PYTHON_VER" && cat /etc/lsb-release
-
  matrix:
    only:
      - image: Visual Studio 2015
      - image: Visual Studio 2019
  install: pip install cython tox
  build_script:
    - echo "Windows %APPVEYOR_BUILD_WORKER_IMAGE% %PYTHON_VER% build script"
      #build_script:
      #- ps: packaging\build\appveyor.ps1

#init:
#- ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

#on_finish:
#- ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
